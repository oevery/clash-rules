anchor-p:
  pf: &pf { type: file, health-check: { enable: true, url: https://www.gstatic.com/generate_204, interval: 300 } }
  ph: &ph { type: http, interval: 43200, proxy: DIRECT, health-check: { enable: true, url: https://www.gstatic.com/generate_204, interval: 300 } }
  preferred_proxy: &preferred_proxy { type: select, proxies: [ä»£ç†, é¦™æ¸¯, å°æ¹¾, æ–°åŠ å¡, æ—¥æœ¬, ç¾å›½, å…¶ä»–åŒºåŸŸ, ç›´è¿] }
  preferred_direct: &preferred_direct { type: select, proxies: [ç›´è¿, ä»£ç†, é¦™æ¸¯, å°æ¹¾, æ–°åŠ å¡, æ—¥æœ¬, ç¾å›½, å…¶ä»–åŒºåŸŸ] }

proxy-providers:
  provider1:
    <<: *ph
    url: "http://example.com/clash.yaml"
    path: ./proxy_providers/provider1.yaml
    # æ’é™¤å€ç‡å¤§äºç­‰äº1çš„èŠ‚ç‚¹
    filter: '.*å€ç‡[:ï¼š]?\s*\b(?:0(?:\.\d+)?|1(?:\.0+)?)(?![\d.])\b.*'
  # æœ¬åœ° provider ç¤ºä¾‹
  # provider2:
  #   <<: *pf
  #   path: ./proxy_providers/provider2.yaml

proxies:
- { name: "ç›´è¿", type: direct , udp: true }

proxy-groups:
- { name: ä»£ç†, type: select, proxies: [é¦™æ¸¯è‡ªåŠ¨é€‰æ‹©, é¦™æ¸¯, æ–°åŠ å¡, å°æ¹¾, æ—¥æœ¬, ç¾å›½, å…¶ä»–åŒºåŸŸ, ç›´è¿] }
- { name: å…¶ä»–, type: select, proxies: [ç›´è¿, ä»£ç†] }
- { name: å›½å¤–åª’ä½“, <<: *preferred_proxy }
- { name: AI, <<: *preferred_proxy }
- { name: Telegram, <<: *preferred_proxy }
- { name: Microsoft, <<: *preferred_proxy }
- { name: Apple, <<: *preferred_direct }
- { name: æ¸¸æˆä¸‹è½½, <<: *preferred_direct }
- { name: æµ‹é€Ÿ, <<: *preferred_direct }
- { name: å›½å†…, type: select, proxies: [ç›´è¿, ä»£ç†] }

- { name: é¦™æ¸¯è‡ªåŠ¨é€‰æ‹©, type: url-test, include-all: true, filter: "(?i)(?!ç›´è¿)(ğŸ‡­ğŸ‡°|æ¸¯|hk|hong)" }
- { name: é¦™æ¸¯, type: select, include-all: true, true, filter: "(?i)(?!ç›´è¿)(ğŸ‡­ğŸ‡°|æ¸¯|hk|hong)" }
- { name: å°æ¹¾, type: select, include-all: true, filter: "(?i)(?!ç›´è¿)(ğŸ‡¹ğŸ‡¼|å°|tw|taiwan)" }
- { name: æ–°åŠ å¡, type: select, include-all: true, filter: "(?i)(?!ç›´è¿)(ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|å¡|ç‹®åŸ|sg|singapore)" }
- { name: æ—¥æœ¬, type: select, include-all: true, filter: "(?i)(?!ç›´è¿)(ğŸ‡¯ğŸ‡µ|æ—¥|ä¸œäº¬|jp|japan)" }
- { name: ç¾å›½, type: select, include-all: true, filter: "(?i)(?!ç›´è¿)(ğŸ‡ºğŸ‡¸|ğŸ‡ºğŸ‡²|ç¾|us|states|america)" }
- { name: å…¶ä»–åŒºåŸŸ, type: select, include-all: true, filter: "(?i)^(?!.*(ç›´è¿|ğŸ‡­ğŸ‡°|æ¸¯|hk|hong|ğŸ‡¹ğŸ‡¼|å°|tw|taiwan|ğŸ‡¸ğŸ‡¬|æ–°åŠ å¡|å¡|ç‹®åŸ|sg|singapore|ğŸ‡¯ğŸ‡µ|æ—¥|ä¸œäº¬|jp|japan|ğŸ‡ºğŸ‡¸|ğŸ‡ºğŸ‡²|ç¾|us|states|america)).*" }

mixed-port: 7890  # HTTP(S) å’Œ SOCKS ä»£ç†æ··åˆç«¯å£
# redir-port: 7893  # é€æ˜ä»£ç†ç«¯å£
# tproxy-port: 7894 # TProxy é€æ˜ä»£ç†ç«¯å£

allow-lan: false # å…è®¸å±€åŸŸç½‘è¿æ¥

mode: rule

log-level: info # æ—¥å¿—ç­‰çº§ silent/error/warning/info/debug

ipv6: true

external-controller: 0.0.0.0:9090
secret: ""

profile:
  store-selected: true
  store-fake-ip: true

unified-delay: true # ç»Ÿä¸€å»¶è¿Ÿ
tcp-concurrent: true  # TCP å¹¶å‘

geodata-mode: true
geox-url:
  geoip: "https://gh.oevery.me/github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geoip.dat"
  geosite: "https://gh.oevery.me/github.com/MetaCubeX/meta-rules-dat/releases/download/latest/geosite.dat"
  mmdb: "https://gh.oevery.me/github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country.mmdb"
  asn: "https://gh.oevery.me/github.com/xishang0128/geoip/releases/download/latest/GeoLite2-ASN.mmdb"

geo-auto-update: false  # æ˜¯å¦è‡ªåŠ¨æ›´æ–° geodata
geo-update-interval: 24 # æ›´æ–°é—´éš”ï¼Œå•ä½ï¼šå°æ—¶

dns:
  enable: true
  cache-algorithm: arc
  use-hosts: true
  listen: 0.0.0.0:1053
  ipv6: true
  enhanced-mode: fake-ip
  # DNSéµå¾ªä»£ç†è®¾ç½®ï¼Œéœ€é…ç½®proxy-server-nameserver
  respect-rules: true
  default-nameserver:
    - https://223.5.5.5/dns-query
  # é»˜è®¤çš„åŸŸåè§£ææœåŠ¡å™¨
  nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
    # - "https://dns.cloudflare.com/dns-query#h3=true"
    # - "https://dns.google/dns-query#h3=true"
  direct-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  # ä¸“ç”¨äºèŠ‚ç‚¹åŸŸåè§£æçš„ DNS æœåŠ¡å™¨
  proxy-server-nameserver:
    - https://doh.pub/dns-query
    - https://dns.alidns.com/dns-query
  # æŒ‡å®šåœ°å€ä½¿ç”¨ç‰¹å®šDNSè§£ææœåŠ¡å™¨
  nameserver-policy:
    "geosite:geolocation-!cn,tld-!cn":
      - "https://dns.cloudflare.com/dns-query#h3=true"
      - "https://dns.google/dns-query#h3=true"
  fake-ip-filter:
    - "*.homelab"
    - "rule-set:fakeip_filter_domainset"

tun:
  enable: true
  stack: mixed
  dns-hijack: ["any:53", "tcp://any:53"]
  auto-route: true  # é…ç½®è·¯ç”±è¡¨
  auto-redirect: true # é‡å®šå‘è¿æ¥
  auto-detect-interface: true # è‡ªåŠ¨è¯†åˆ«å‡ºå£ç½‘å¡
  route-exclude-address:
    - 192.168.0.0/16
    - 10.0.0.0/8
    - 100.64.0.0/10
    - fc00::/7
    - fd7a:115c:a1e0::/48
  exclude-package:
    - com.tailscale.ipn

anchor-rule:
  classical: &classical { type: http, behavior: classical, format: text, interval: 43200 }
  domain: &domain { type: http, behavior: domain, format: text, interval: 43200 }
  ip: &ip { type: http, behavior: ipcidr, format: text, interval: 43200 }

rule-providers:
  reject_non_ip_no_drop:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/reject-no-drop.txt
    path: ./sukkaw_ruleset/reject_non_ip_no_drop.txt
  reject_non_ip_drop:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/reject-drop.txt
    path: ./sukkaw_ruleset/reject_non_ip_drop.txt
  reject_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/reject.txt
    path: ./sukkaw_ruleset/reject_non_ip.txt
  reject_domainset:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/domainset/reject.txt
    path: ./sukkaw_ruleset/reject_domainset.txt
  reject_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/reject.txt
    path: ./sukkaw_ruleset/reject_ip.txt

  speedtest:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/domainset/speedtest.txt
    path: ./sukkaw_ruleset/speedtest.txt

  stream_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/stream.txt
    path: ./sukkaw_ruleset/stream_non_ip.txt
  stream_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/stream.txt
    path: ./sukkaw_ruleset/stream_ip.txt

  ai_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/ai.txt
    path: ./sukkaw_ruleset/ai_non_ip.txt
  apple_intelligence_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/apple_intelligence.txt
    path: ./sukkaw_ruleset/apple_intelligence_non_ip.txt

  telegram_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/telegram.txt
    path: ./sukkaw_ruleset/telegram_non_ip.txt
  telegram_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/telegram.txt
    path: ./sukkaw_ruleset/telegram_ip.txt

  apple_cdn:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/domainset/apple_cdn.txt
    path: ./sukkaw_ruleset/apple_cdn.txt
  apple_services:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/apple_services.txt
    path: ./sukkaw_ruleset/apple_services.txt
  apple_cn_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/apple_cn.txt
    path: ./sukkaw_ruleset/apple_cn_non_ip.txt

  microsoft_cdn_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/microsoft_cdn.txt
    path: ./sukkaw_ruleset/microsoft_cdn_non_ip.txt
  microsoft_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/microsoft.txt
    path: ./sukkaw_ruleset/microsoft_non_ip.txt

  lan_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/lan.txt
    path: ./sukkaw_ruleset/lan_non_ip.txt
  lan_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/lan.txt
    path: ./sukkaw_ruleset/lan_ip.txt

  private_tracker:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PrivateTracker/PrivateTracker.list
    path: ./blackmatrix7_ruleset/private_tracker.txt

  steam_cn:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/SteamCN/SteamCN.list
    path: ./blackmatrix7_ruleset/steam_cn.txt
  game_download_cn:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/GameDownloadCN/GameDownloadCN.list
    path: ./blackmatrix7_ruleset/game_download_cn.txt
  game_download_domainset:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/domainset/game-download.txt
    path: ./sukkaw_ruleset/game_download_domainset.txt

  download_domainset:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/domainset/download.txt
    path: ./sukkaw_ruleset/download_domainset.txt
  download_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/download.txt
    path: ./sukkaw_ruleset/download_non_ip.txt

  domestic_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/domestic.txt
    path: ./sukkaw_ruleset/domestic_non_ip.txt
  direct_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/direct.txt
    path: ./sukkaw_ruleset/direct_non_ip.txt
  global_non_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/non_ip/global.txt
    path: ./sukkaw_ruleset/global_non_ip.txt
  domestic_ip:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/domestic.txt
    path: ./sukkaw_ruleset/domestic_ip.txt

  china_ip:
    <<: *ip
    url: https://gh.oevery.me/raw.githubusercontent.com/SukkaLab/ruleset.skk.moe/master/Clash/ip/china_ip.txt
    path: ./sukkaw_ruleset/china_ip.txt

  my_direct:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/oevery/clash-rules/master/my_direct.txt
    path: ./oevery_ruleset/my_direct.txt
  my_proxy:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/oevery/clash-rules/master/my_proxy.txt
    path: ./oevery_ruleset/my_proxy.txt
  my_plus:
    <<: *classical
    url: https://gh.oevery.me/raw.githubusercontent.com/oevery/clash-rules/master/my_plus.txt
    path: ./oevery_ruleset/my_plus.txt

  fakeip_filter_domainset:
    <<: *domain
    url: https://gh.oevery.me/raw.githubusercontent.com/juewuy/ShellCrash/dev/public/fake_ip_filter.list
    path: ./shellcrash_ruleset/fakeip_filter_domainset.txt

rules:
  - RULE-SET,my_direct,ç›´è¿
  - RULE-SET,my_plus,å›½å†…
  - RULE-SET,my_proxy,ä»£ç†

  - RULE-SET,reject_non_ip_drop,REJECT-DROP
  - RULE-SET,reject_domainset,REJECT
  - RULE-SET,reject_non_ip,REJECT
  - RULE-SET,reject_non_ip_no_drop,REJECT
  - RULE-SET,reject_ip,REJECT

  - RULE-SET,speedtest,æµ‹é€Ÿ

  - RULE-SET,stream_non_ip,å›½å¤–åª’ä½“
  - RULE-SET,stream_ip,å›½å¤–åª’ä½“

  - RULE-SET,ai_non_ip,AI
  - RULE-SET,apple_intelligence_non_ip,AI

  - RULE-SET,telegram_non_ip,Telegram
  - RULE-SET,telegram_ip,Telegram

  - RULE-SET,apple_cdn,å›½å†…
  - RULE-SET,apple_services,Apple
  - RULE-SET,apple_cn_non_ip,å›½å†…

  - RULE-SET,microsoft_cdn_non_ip,å›½å†…
  - RULE-SET,microsoft_non_ip,Microsoft

  - RULE-SET,private_tracker,ç›´è¿

  - RULE-SET,steam_cn,å›½å†…
  - RULE-SET,game_download_cn,å›½å†…
  - RULE-SET,game_download_domainset,æ¸¸æˆä¸‹è½½

  - RULE-SET,download_domainset,ä»£ç†
  - RULE-SET,download_non_ip,ä»£ç†

  - RULE-SET,lan_non_ip,ç›´è¿
  - RULE-SET,lan_ip,ç›´è¿

  - RULE-SET,domestic_non_ip,å›½å†…
  - RULE-SET,direct_non_ip,ç›´è¿
  - RULE-SET,global_non_ip,ä»£ç†
  - RULE-SET,domestic_ip,å›½å†…
  - RULE-SET,china_ip,å›½å†…

  - MATCH,å…¶ä»–